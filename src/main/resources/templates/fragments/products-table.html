<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="table">
    <div class="table-meta">
        <div class="meta-left">
            <wa-icon name="grid" class="mr-1" aria-hidden="true"></wa-icon>
            <span class="muted">Products:</span>
            <span class="pill" th:text="${#lists.size(products)}">0</span>
        </div>
        <div class="meta-actions">
            <a class="link" hx-get="/products" hx-target="#products-table" hx-swap="innerHTML">
                <wa-icon name="refresh-cw" class="mr-1" aria-hidden="true"></wa-icon>
                Refresh
            </a>
        </div>
    </div>
    <table class="products modern" role="grid">
        <thead>
        <tr role="row">
            <th scope="col">ID</th><th scope="col">Title</th><th scope="col">Price</th><th scope="col">URL</th><th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(products)}" class="empty-row">
            <td colspan="5" class="empty">
                <div class="empty-state">
                    <wa-icon name="package" class="empty-icon" aria-hidden="true"></wa-icon>
                    <div>
                        <strong>No products yet</strong>
                        <div class="muted">Use Refresh to load products or add one using the form.</div>
                    </div>
                </div>
            </td>
        </tr>

        <tr th:each="p : ${products}">
            <td class="mono" th:text="${p.id}"></td>
            <td><span class="truncate" th:text="${p.title}"></span></td>
            <td>
                <wa-badge th:if="${p.price != null}"
                          color="neutral" variant="soft" size="small"
                          th:text="${'kr ' + #numbers.formatDecimal(p.price, 1, 'COMMA', 2, 'POINT')}"></wa-badge>
                <span th:if="${p.price == null}">—</span>
            </td>
            <td>
                <wa-button th:if="${p.url}"
                           href="" th:attr="href=${p.url}"
                           target="_blank" rel="noreferrer noopener"
                           variant="text" size="small">
                    <wa-icon slot="prefix" name="external-link"></wa-icon>
                    Open
                </wa-button>
                <span th:if="${p.url == null}">—</span>
            </td>
            <td>
                <div style="display:flex; gap:.5rem; align-items:center;">
                    <a th:href="@{'/products/' + ${p.id} + '/edit'}" class="link">
                        <wa-icon name="pencil" class="mr-1" aria-hidden="true"></wa-icon>
                        Edit
                    </a>
                    <wa-button variant="text" size="small"
                               th:attr="hx-post=@{'/products/' + ${p.id} + '/delete'}"
                               hx-target="#products-table"
                               hx-swap="innerHTML"
                               hx-confirm="Are you sure you want to delete this product? This cannot be undone.">
                        <wa-icon slot="prefix" name="trash-2"></wa-icon>
                        Delete
                    </wa-button>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>
