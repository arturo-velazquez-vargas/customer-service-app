<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="table"
     th:with="base=${q} != null ? '/products/search' : '/products',
               nextDir=${dir} == 'asc' ? 'desc' : 'asc'">
    <div class="table-meta">
        <div class="meta-left">
            <wa-icon name="grid" class="mr-1" aria-hidden="true"></wa-icon>
            <span class="muted">Products:</span>
            <span class="pill" th:text="${#lists.size(products)}">0</span>
        </div>
        <div class="meta-right" style="display:flex; gap:.5rem; align-items:center;">
            <wa-button size="small" variant="text"
                       th:classappend="${hasPrev} ? '' : 'disabled'"
                       th:attr="hx-get=@{${base}(q=${q},page=${page - 1},size=${size},sort=${sort},dir=${dir})}"
                       hx-target="#products-table" hx-swap="innerHTML" th:disabled="${!hasPrev}">
                <wa-icon slot="prefix" name="chevron-left"></wa-icon>
                Prev
            </wa-button>
            <span class="muted" th:text="${'Page ' + (page + 1)}">Page 1</span>
            <wa-button size="small" variant="text"
                       th:classappend="${hasNext} ? '' : 'disabled'"
                       th:attr="hx-get=@{${base}(q=${q},page=${page + 1},size=${size},sort=${sort},dir=${dir})}"
                       hx-target="#products-table" hx-swap="innerHTML" th:disabled="${!hasNext}">
                Next
                <wa-icon slot="suffix" name="chevron-right"></wa-icon>
            </wa-button>
        </div>
    </div>
    <table class="products modern" role="grid">
        <thead>
        <tr role="row">
            <th scope="col">
                <a class="link" th:attr="hx-get=@{${base}(q=${q},page=${page},size=${size},sort='id',dir=${sort}=='id' ? ${nextDir} : 'asc')}"
                   hx-target="#products-table" hx-swap="innerHTML">ID
                    <wa-icon th:if="${sort}=='id'" name="arrow-up" th:classappend="${dir}=='asc' ? '' : ' rotate-180'"></wa-icon>
                </a>
            </th>
            <th scope="col">
                <a class="link" th:attr="hx-get=@{${base}(q=${q},page=${page},size=${size},sort='title',dir=${sort}=='title' ? ${nextDir} : 'asc')}"
                   hx-target="#products-table" hx-swap="innerHTML">Title
                    <wa-icon th:if="${sort}=='title'" name="arrow-up" th:classappend="${dir}=='asc' ? '' : ' rotate-180'"></wa-icon>
                </a>
            </th>
            <th scope="col">
                <a class="link" th:attr="hx-get=@{${base}(q=${q},page=${page},size=${size},sort='price',dir=${sort}=='price' ? ${nextDir} : 'asc')}"
                   hx-target="#products-table" hx-swap="innerHTML">Price
                    <wa-icon th:if="${sort}=='price'" name="arrow-up" th:classappend="${dir}=='asc' ? '' : ' rotate-180'"></wa-icon>
                </a>
            </th>
            <th scope="col">URL</th>
            <th scope="col">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(products)}" class="empty-row">
            <td colspan="5" class="empty">
                <div class="empty-state">
                    <wa-icon name="package" class="empty-icon" aria-hidden="true"></wa-icon>
                    <div>
                        <strong>No products yet</strong>
                        <div class="muted">Use Refresh to load products or add one using the form.</div>
                    </div>
                </div>
            </td>
        </tr>

        <tr th:each="p : ${products}">
            <td class="mono" th:text="${p.id}"></td>
            <td><span class="truncate" th:text="${p.title}"></span></td>
            <td>
                <wa-badge th:if="${p.price != null}"
                          color="neutral" variant="soft" size="small"
                          th:text="${'kr ' + #numbers.formatDecimal(p.price, 1, 'COMMA', 2, 'POINT')}"></wa-badge>
                <span th:if="${p.price == null}">—</span>
            </td>
            <td>
                <wa-button th:if="${p.url}"
                           href="" th:attr="href=${p.url}"
                           target="_blank" rel="noreferrer noopener"
                           variant="text" size="small">
                    <wa-icon slot="prefix" name="external-link"></wa-icon>
                    Open
                </wa-button>
                <span th:if="${p.url == null}">—</span>
            </td>
            <td>
                <div style="display:flex; gap:.5rem; align-items:center;">
                    <a th:href="@{'/products/' + ${p.id} + '/edit'}" class="link">
                        <wa-icon name="pencil" class="mr-1" aria-hidden="true"></wa-icon>
                        Edit
                    </a>
                    <wa-button variant="text" size="small"
                               th:attr="hx-post=@{'/products/' + ${p.id} + '/delete'}"
                               hx-target="#products-table"
                               hx-swap="innerHTML"
                               hx-confirm="Are you sure you want to delete this product? This cannot be undone.">
                        <wa-icon slot="prefix" name="trash-2"></wa-icon>
                        Delete
                    </wa-button>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

</body>
</html>
